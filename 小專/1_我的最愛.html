<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的最愛</title>
    <script src="./_js/jquery-3.7.1.js"></script>
    <link rel="stylesheet" href="./css/1_style.css">
</head>

<style>
    body {
        display: flex;
        align-items: flex-start;
        justify-content: center;
        /* padding-top: 30vh; */
    }

    #favList {
        width: 800px;
        margin: auto;
        border: solid 1px black;
        border-radius: 8px;
    }

    h2 {
        font-size: 30px;
    }

    img {
        width: 200px;
        height: 200px;
    }

    .favItem {
        display: flex;
    }

    .favItem h4 {
        margin-left: 20px;
    }

    .favItem p {
        margin-left: 50px;
    }

    .btnArea {
        align-content: center;
        margin-left: 320px;
    }

    button {
        /* margin-left: 695px; */
        border-radius: 6px;
        font-size: 16px;
        padding: 6px 15px;
        background-color: black;
        color: white;
        border: none;
    }
</style>

<body>
    <main>
        <h2>我的最愛</h2>
        <div id="favList">

        </div>
        <!-- <script src="./_js/1_script.js"></script> -->
    </main>
</body>

<!-- 加入最愛 -->
<script>
    function loadFav() {
        return JSON.parse(localStorage.getItem('fav')) || [];
    }

    const favList = document.getElementById('favList');

    function showFav() {
        const fav = loadFav();
        if (fav.length == 0) {
            favList.innerHTML = '<p>目前沒有最愛商品</p>'
            return;
        }

        favList.innerHTML = fav.map((item, index) => {
            return `<div class="favItem" data-index="${index}">
                    <img src=${item.img}>
                    <main class='main'>
                    <h4>${item.name}</h4>
                    <p>價格: $${item.price}</p>
                    </main>
                    <div class="btnArea">
                        <button class="btnRemoveFav">移除最愛</button>
                    </div>
                </div>`
        }).join('');
    }

    showFav();

    // 綁定移除按鈕事件
    document.querySelectorAll('.btnRemoveFav').forEach(btn => {
                btn.addEventListener('click', (e) => {

                    // 找到e.target(被點擊的元素 -> 刪除按鈕<button>)最近的父元素
                    // 取出 HTML 裡的 data-index 屬性值
                    const index = e.target.closest('.favItem').dataset.index;
                    removeFromFav(index);
                })
            })

    function removeFromFav(index) {
        const fav = loadFav();
        fav.splice(index, 1);
        localStorage.setItem('fav', JSON.stringify(fav));
        showFav();
    }
</script>

</html>